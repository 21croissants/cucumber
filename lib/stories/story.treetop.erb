grammar Story
  rule story
    header narrative scenario*
  end

  rule header
    'Story: ' sentence_line
  end

  rule narrative
    'As a' sentence_line
  end

  rule scenario
    'Scenario: ' sentence_line step*
  end

  rule step
    # The various step rules are generated dynamically
    'Given ' (step_0 / step_1)
  end

<% @additional_rules.each_with_index do |rule, i| %>
  # Dynamically generated rule
  rule step_<%= i %>
    <%= rule %>
  end
<% end %>

  rule word
    ([\w])*
  end

  rule sentence_line
    (!eol .)* eol
  end

  rule eol
    "\n" / eof
  end
  
  rule eof
    !.
  end
end
grammar Story
  rule story
    header_node narrative_node scenario_nodes:scenario* <Cucumber::Parser::StoryNode>
  end

  rule header_node
    '<%= words['story'] %>:' space sentence_line <Cucumber::Parser::HeaderNode>
  end

  rule narrative_node
    (!scenario_start .)* <Cucumber::Parser::NarrativeNode>
  end

  rule scenario
    scenario_start sentence:sentence_line step_nodes:(step)* <Cucumber::Parser::ScenarioNode>
  end
  
  rule scenario_start
    space '<%= words['scenario'] %>: '
  end

  rule step
    space step_type:('<%= words['given'] %>' / '<%= words['when'] %>' / '<%= words['then'] %>'/ '<%= words['and'] %>' / '<%= words['given_scenario'] %>') space sentence:sentence_line <Cucumber::Parser::StepNode>
  end

  rule sentence_line
    (!eol .)* eol
  end

  rule space
    [ \t\r\n]*
  end

  rule eol
    "\r\n" / "\n" / eof
  end
  
  rule eof
    !.
  end
end
